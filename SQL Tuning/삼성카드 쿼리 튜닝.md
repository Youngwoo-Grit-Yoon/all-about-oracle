# 첫 번째
## 튜닝 대상
```text
select t1.clientlog_sq_id 
       ,cm.etc_2_ctnt as center_id
       ,case when cm.etc_2_ctnt  = 'SC' then '서울센터' 
             when etc_2_ctnt = 'DC' then '대전센터' end as center_nm
       ,t1.server_id 
       ,t1.log_level 
       ,to_char(t1.log_dttm, 'yyyy-mm-dd HH24:mi:ss.ms') as log_dttm
       ,t1.log 
       ,t1.error_code 
from bridge_manager.tb_bm_mc_cti_client_log t1
inner join bridge_manager.tb_bm_cm_codebook cm on (cm.cd_type_id = 'RS002' and t1.server_id = cm.cd_id)
where to_char(t1.log_dttm, 'yyyymmdd')::text like CONCAT('%', '20230921', '%') 
order by t1.log_dttm desc
```
## 튜닝 결과 
```text
select t1.clientlog_sq_id 
       ,cm.etc_2_ctnt as center_id
       ,case when cm.etc_2_ctnt  = 'SC' then '서울센터' 
             when etc_2_ctnt = 'DC' then '대전센터' end as center_nm
       ,t1.server_id 
       ,t1.log_level 
       ,to_char(t1.log_dttm, 'yyyy-mm-dd HH24:mi:ss.ms') as log_dttm
       ,t1.log 
       ,t1.error_code 
from bridge_manager.tb_bm_mc_cti_client_log t1
inner join bridge_manager.tb_bm_cm_codebook cm on (cm.cd_type_id = 'RS002' and t1.server_id = cm.cd_id)
where t1.log_dttm between TO_TIMESTAMP('20230921', 'YYYYMMDD') and TO_TIMESTAMP('20230921', 'YYYYMMDD') + INTERVAL '1 day - 1 second'
order by t1.log_dttm desc;
```

# 두 번째
## 튜닝 결과
```text
select t1.event_sq_id 
       ,t1.server_id 
       ,t1.unique_call_id 
       ,t1.comment
       ,t1.station 
       ,t1.vdn_no 
       ,t1.vdn_type 
       ,cb.cd_nm as vdn_type_nm
       ,t1.ucid 
       ,t1.callid
       ,t1.dropped
       ,t1.log_dttm
       ,t1.ani
       ,t1.call_type
       ,(ROW_NUMBER() OVER()) AS rownum
from bridge_manager.tb_bm_mc_call_tracking_event t1 
left outer join bridge_manager.tb_bm_cm_codebook cb 
on (t1.vdn_type = cb.cd_id
    and cb.cd_type_id = 'RS010' 
    and cb.cd_id != '00')
where t1.unique_call_id = 'unique_call_id_value'
order by t1.server_id asc, t1.log_dttm asc ,t1.event_sq_id asc;
```

# 세 번째
```text
select t1.unique_call_id
       ,t1.server_id 
       ,t1.search_log 
from bridge_manager.tb_bm_mc_call_tracking_logview t1
where t1.unique_call_id = 'unique_call_id_value';
```

# 네 번째
```text
with a as (
select t1.vdn_no,
       t1.center_id,
       rs001.cd_nm as center_nm,
       t1.vdn_type,
       rs010.cd_nm as type_nm,
       t1.check_link,
       t1.split,
       t1.comment,
       t1.monitoring_yn,
       h1.user_nm as regi_user_nm,
       t1.updt_dttm,
       coalesce(h2.user_nm, '') as updt_user_nm,
       case when t1.server_id in ('SC-CTI-01', 'DC-CTI-01') then result else '' end as cti_01_result,
       case when t1.server_id in ('SC-CTI-02', 'DC-CTI-02') then result else '' end as cti_02_result
from bridge_manager.tb_bm_mn_vdn t1
inner join bridge_manager.tb_bm_cm_codebook rs001 on (t1.center_id::text = rs001.cd_id::text and rs001.cd_type_id::text = 'RS001'::text)
inner join bridge_manager.tb_bm_cm_codebook rs002 on (t1.server_id::text = rs002.cd_id::text and rs002.cd_type_id::text = 'RS002'::text)
inner join bridge_manager.tb_bm_cm_codebook rs010 on (t1.vdn_type::text = rs010.cd_id::text and rs010.cd_type_id::text = 'RS010'::text)
inner join bridge_manager.tb_bm_hr_user h1 on (t1.regi_user_id = h1.user_id)
left outer join bridge_manager.tb_bm_hr_user h2 on (t1.updt_user_id = h2.user_id)
where t1.center_id = 'SC'
--and t1.vdn_type in (case (select count(*) from bridge_manager.fc_cm_inlist('cm_list_values')) when 0 then t1.vdn_type
--                    else (select column_value from bridge_manager.fc_cm_inlist('cm_list_values')) end)
--and t1.vdn_no = case when 'vdn_no_value' is null or 'vdn_no_value' = '' then t1.vdn_no else 'vdn_no_value' end
--and t1.monitoring_yn = case when 'Y' is null or 'Y' = '' then t1.monitoring_yn else 'Y' end
group by t1.vdn_no
         ,t1.center_id
         ,rs001.cd_nm
         ,t1.server_id
         ,t1.vdn_type
         ,rs010.cd_nm
         ,t1.result
         ,t1.monitoring_yn
         ,t1.check_link
         ,t1.split
         ,t1.comment
         ,h1.user_nm
         ,h2.user_nm
         ,t1.updt_dttm
)
select vdn_no
       ,center_id
       ,center_nm
       ,vdn_type
       ,type_nm
       ,monitoring_yn
       ,check_link
       ,split AS split_no
       ,comment
       ,regi_user_nm
       ,updt_user_nm
       ,updt_dttm
       ,max(cti_01_result) as cti_01_result
       ,max(cti_02_result) as cti_02_result
from a
group by vdn_no, center_id, center_nm, vdn_type, type_nm, monitoring_yn, check_link, split,comment, regi_user_nm, updt_user_nm, updt_dttm
order by vdn_no asc
```

# 다섯 번째
## 튜닝 대상
```text
  <insert id="isac_mn_mn010_insertVdnInfo" parameterType="paramMap">
  <choose>
  <when test = "isMultiple == false">
   /* isac_mn_mn010_insertVdnInfo, VDN정보저장 */
   INSERT INTO bridge_manager.tb_bm_mn_vdn
   (
           vdn_no 
         , center_id 
         , server_id 
         , vdn_type
         , split 
         , check_link 
         , comment
         , result
         , regi_user_id 
         , regi_dttm
         , updt_user_id
         , updt_dttm
         , monitoring_yn
         , modify_flag
         )
   VALUES
   (
           #{vdnNo}
         , #{centerCd}
         , #{serverCd}
         , #{vdnTypeCd}
         , #{split}
         , #{checkLink}
         , #{comment}
         , '90002'
         , coalesce(#{regUserId}, '') 
         , CURRENT_TIMESTAMP   
         , coalesce(#{regUserId}, '')
         , CURRENT_TIMESTAMP
         , #{monitoringYn}
         , '1'
   )
   </when>
   <otherwise >
   /* isac_mn_mn010_insertVdnInfo, VDN정보저장 */
      WITH RECURSIVE test_tbl AS (
      SELECT 1 AS num
            , #{vdnNo} AS vdn_no
            , #{centerCd} AS center_id
            , (select split_part(#{serverCd}, ',', 1)) AS server_id
            , #{vdnTypeCd} AS vdn_type
            , #{split} AS split
          , #{checkLink} AS check_link
          , #{comment} AS comment
          , '90002' AS result
          , coalesce(#{regUserId}, '') AS regi_user_id
          , CURRENT_TIMESTAMP AS regi_dttm
          , coalesce(#{updUserId}, '') AS updt_user_id
          , CURRENT_TIMESTAMP AS updt_dttm
          , #{monitoringYn} AS monitoring_yn
          , '1' AS modify_flag
      UNION ALL
      SELECT num + 1
            , #{vdnNo} AS vdn_no
            , #{centerCd} AS center_id
            , (select split_part(#{serverCd}, ',', 2)) AS server_id
            , #{vdnTypeCd} AS vdn_type
            , #{split} AS split
          , #{checkLink} AS check_link
          , #{comment} AS comment
          , '90002' AS result
           , coalesce(#{regUserId}, '') AS regi_user_id
          , CURRENT_TIMESTAMP AS regi_dttm     
          , coalesce(#{updUserId}, '') AS updt_user_id
          , CURRENT_TIMESTAMP AS updt_dttm
          , #{monitoringYn} AS monitoring_yn
          , '1' AS modify_flag
      FROM test_tbl WHERE num <![CDATA[ < ]]> 2
   ) 
   INSERT INTO bridge_manager.tb_bm_mn_vdn 
   (
            vdn_no
         , center_id
         , server_id
         , vdn_type
         , split
         , check_link
         , comment
         , result
         , regi_user_id
         , regi_dttm
         , updt_user_id
         , updt_dttm
         , monitoring_yn
         , modify_flag
   )
   select  test_tbl.vdn_no
         , test_tbl.center_id
         , test_tbl.server_id
         , test_tbl.vdn_type
         , test_tbl.split
         , test_tbl.check_link
         , test_tbl.comment
         , test_tbl.result
         , test_tbl.regi_user_id
         , test_tbl.regi_dttm
         , test_tbl.updt_user_id
         , test_tbl.updt_dttm
         , test_tbl.monitoring_yn
         , test_tbl.modify_flag
   FROM test_tbl
   </otherwise>
   </choose>
   </insert>
```
## 튜닝 결과
```text

```