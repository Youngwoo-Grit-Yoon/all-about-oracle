## 삼성증권 일별 통계 집계 쿼리 튜닝 보고서
### SQL ID
VX_QUEUE02_ABANDON_DAY
(튜닝 대상 SQL은 VIEW를 구성하는 쿼리문이므로 VIEW 이름으로 대체)
### 튜닝 완료 일자
2023년 01월 17일 화요일
### 튜닝 작업자
- 플랫폼개발2팀 윤영우 선임
- AICC개발2팀 주인선 선임
- AICC개발2팀 최원준 선임
### 튜닝 전/후 쿼리 소요 시간 및 입출력 블록 수
| 튜닝 전   | 튜닝 후 |
|--------|------|
| 1분 40초 | 2초   |
쿼리 튜닝 성공의 척도는 전체 버퍼 블록 입출력 블록 수이지만 Oracle이 아닌 MS-SQL의 SQL Trace를 보는 것에 익숙하지 않아 확인하지 못 하였습니다.
### 원문 SQL
내용이 상당히 길어 핵심 내용만 기재하였습니다.
```mysql-sql
SELECT MSF.START_DATE_TIME_KEY AS Q_DATE_TIME_KEY,
       'DAY' AS Q_DAY,
       DT.CAL_DATE AS Q_CAL_DATE,
       DT.CAL_YEAR_NUM AS Q_CAL_YEAR_NUM
       ...
FROM MEDIATION_SEGMENT_FACT MSF
     INNER JOIN DATE_TIME TD ON (MSF.TECHNICAL_DESCRIPTOR_KEY = TD.TECHNICAL_DESCRIPTOR_KEY)
     ...
     INNER JOIN RESOURCE_ R ON (R.RESOURCE_KEY = MSF.RESOURCE_KEY AND R.RESOURCE_TYPE_CODE = 'QUEUE')
WHERE ...
      MSF.START_DATE_TIME_KEY 
      BETWEEN (SELECT ... CAL_DATE <= '2022-10-13') AND (SELECT ... CAL_DATE <= '2022-10-13')
      AND S_CNFR_CLSS_CD IN ('FM');
```
### 원문 SQL Trace
당시 MS-SQL 쿼리의 실제 Trace 결과가 텍스트가 아닌 이미지 추출 되었습니다. 해당 이미지 내용을 토대로 하기 Oracle Trace 형태로 다시
작성하였습니다.
```oracle-sql
...
WHATEVER JOIN
    NESTED LOOPS
        TABLE ACCESS FULL  --> RESOURCE_ 테이블 FULL SCAN 후 반환 Rows는 168행
        TABLE ACCESS FULL  --> MEDIATION_SEGMENT_FACT 테이블을 168번 중첩 루프를 통해 FULL SCAN
    WHATEVER VIEW
...
```
### 문제점
